var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,h,d){a!=Array.prototype&&a!=Object.prototype&&(a[h]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,h,d,b){if(h){d=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var e=a[b];e in d||(d[e]={});d=d[e]}a=a[a.length-1];b=d[a];h=h(b);h!=b&&null!=h&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:h})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,d,b){var e=this.length||0;0>d&&(d=Math.max(0,e+d));if(null==b||b>e)b=e;b=Number(b);0>b&&(b=Math.max(0,e+b));for(d=Number(d||0);d<b;d++)this[d]=a;return this}},"es6-impl","es3");
window.addEventListener("load",function(a){function h(a,e){function b(){redraw();f.load(a)}var f=new FivekoGFX,g=document.getElementById("controls");addFilter(new Filter("Box Blur",function(){this.add(createSlider(g,"sigmaSlider","Sigma",1.5,0,10,.5,this.update.bind(this)))},function(a){f.blur(a);f.draw(e)},b));addFilter(new Filter("Grayscale",function(){},function(a){f.rgb2grey(a);f.draw(e)},b));addFilter(new Filter("Gaussian Blur",function(){this.add(createSlider(g,"sigmaSlider","Sigma",1.5,0,10,
.5,this.update.bind(this)))},function(a){f.gauss(a);f.draw(e)},b));addFilter(new Filter("Sobel",function(){this.add(createSlider(g,"sigmaSlider","Gauss Sigma",1.5,0,10,.5,this.update.bind(this)))},function(a){f.blur(a);f.sobel();f.draw(e)},b));addFilter(new Filter("HoughCircle",function(){this.add(createSlider(g,"sizeSlider","Size",20,0,100,5,this.update.bind(this)));this.add(createSlider(g,"sigmaSlider","SigmaSobel",1.5,0,10,.5,this.update.bind(this)))},function(a,b){f.gauss(b);f.sobel();f.houghCircle(a);
f.draw(e)},b));addFilter(new Filter("SymmenticNN",function(){this.add(createSlider(g,"sizeSlider","Size",3,0,10,1,this.update.bind(this)));this.add(createSlider(g,"countSlider","Count",1,0,10,1,this.update.bind(this)))},function(a,b){f.symmetricnn(parseInt(a),parseInt(b));f.draw(e)},b));addFilter(new Filter("Watershed",function(){this.add(createSlider(g,"sigmaSlider","Sigma",1,0,10,.5,this.update.bind(this)));this.add(createButton(g,"cmdExecute","Execute",this.update.bind(this)));this.seeds=[{pixels:[]},
{pixels:[]}];var a=this;e.onmousedown=e.onmousemove=function(b){if(b.buttons){var c=b.offsetX,l=b.offsetY;b=1==b.buttons?0:1;if(-1===a.seeds[b].pixels.indexOf(4*(c+l*e.width))){a.seeds[b].pixels.push(4*(c+l*e.width));var p=e.getContext("2d");p.fillStyle=b?"red":"green";p.fillRect(c,l,6,6)}}}.bind(this)},function(a){this.seeds[0].pixels.length&&(f.gauss(a),f.draw(e),f.watershed(e,this.seeds))},b));addFilter(new Filter("HarrisCorners",function(){this.add(createSlider(g,"sizeSlider","Min Distance",11,
1,51,2,this.update.bind(this)));this.add(createSlider(g,"thresholdSlider","Threshold",20,0,100,5,this.update.bind(this)))},function(a,b){f.harrisCorners();f.nms(a);var c=b/100,l=e.getContext("2d");l.strokeStyle="#FF0000";l.fillStyle="#00FF00";l.lineWidth=5;for(var p=f.getImageData(0,0,e.width,e.height).data,d=0,m=4*e.width;d<p.length;d+=4)if(p[d]>c){var g=d/4%e.width,h=~~(d/m);l.beginPath();l.arc(g,e.height-h,3,0,2*Math.PI);l.stroke();l.fill()}},b));addFilter(new Filter("Bilaterial",function(){this.add(createSlider(g,
"intensitySlider","Intensity",.2,.01,.5,.01,this.update.bind(this)));this.add(createSlider(g,"edgeSlider","Edge",40,0,100,1,this.update.bind(this)));this.add(createSlider(g,"countSlider","Count",5,0,10,1,this.update.bind(this)))},function(a,b,c){f.bilateral(1,a,b,parseInt(c));f.draw(e)},b));selectFilter(d)}var d=(a=document.getElementById("filterScript"))?a.getAttribute("data-name"):"";""!==d&&(a=a.getAttribute("callback-name"),window[a?a:"initPreview"]=h,console.log("callback: %o",a))});/*
 Created by FIVEKO.com 2017

 The source code is designed and developed for educational purposes only. 
 It is designed for no other purpose and neither the authors nor their institutions 
 accept any liability concerning its use.

*/
window.addEventListener("load",function(a){function h(a){var b=a.width||a.videoWidth;a=a.height||a.videoHeight;var c=(480<document.documentElement.clientWidth?480:document.documentElement.clientWidth-100)/Math.max(b,a);k.width=b*c;k.height=a*c}function d(a,b){var c=document.getElementsByTagName("video")[0];if(!c){var l=function(){c.play();c.muted=!0;h(c);clearInterval(d);d=setInterval(function(){document.getElementById("cmbFilters").getFilter().update()},40)},d,c=document.createElement("video");c.addEventListener("canplaythrough",
l,!0);c.addEventListener("ended",function(){clearInterval(d)},!0);k.onclick=function(){c.paused?l():(c.pause(),clearInterval(d))}}try{c.srcObject=a}catch(r){window.URL.revokeObjectURL(c.src),c.src=window.URL.createObjectURL(a)}window.redraw=function(){k.getContext("2d").drawImage(c,0,0,k.width,k.height)}}function b(a,b){g.onload=function(){h(this);k.getContext("2d").drawImage(this,0,0,k.width,k.height);b()};window.redraw=function(){k.getContext("2d").drawImage(g,0,0,k.width,k.height)};a?"string"===
typeof a?g.src=a:(window.URL.revokeObjectURL(g.src),g.src=window.URL.createObjectURL(a)):b()}function e(a){a=a.target.files[0];var c=a.type;(c="image"==c.substring(0,5)?b:"video"==c.substring(0,5)?d:null)&&c(a,function(){document.getElementById("cmbFilters").onchange()})}function q(a,b,d,e){this.controls=[];this.name=a;this.init=function(){this.controls=[];b.call(this);this.update.call(this)};this.update=function(){var a=new Date;e.call(this);for(var b=[],c=0;c<this.controls.length;c++)b.push(this.controls[c].value);
d.apply(this,b);b=new Date;document.getElementById("log").innerText="Elapsed: "+(b-a)+" ms"};this.reset=e}var f=document.querySelector("div[data-role=preview]");if(f){var g=new Image,k=document.createElement("canvas");f.insertBefore(k,f.firstChild);(function(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("style");c.setAttribute("type","text/css");c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a));b.appendChild(c)})(".input-group-addon.title{min-width:120px;}.input-group-addon.value{width:60px;}");
(function(){var a=document.createElement("div");a.innerHTML='<input type="file" style="display: none;"><button data-role="browse" style="margin: 10px; width: 100px;">Browse</button><button data-role="camera" style="margin: 10px; width: 100px;">Camera</button><select id="cmbFilters"></select>';a.querySelector("input[type=file]").addEventListener("change",e);a.querySelector("button[data-role=browse]").addEventListener("click",function(){a.querySelector("input[type=file]").click()});a.querySelector("button[data-role=camera]").addEventListener("click",
function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;navigator.getUserMedia&&navigator.getUserMedia({video:!0},function(a){d(a,function(){console.log("Camera stream started!")})},function(a){alert("Failed to initialize camera!")})});f.insertBefore(a,f.firstChild)})();var n=document.getElementById("cmbFilters");n.onchange=function(){document.getElementById("controls").innerHTML="";this.getFilter().init();
return!1};n.getFilter=function(){return this.options[this.selectedIndex].filter};q.prototype.add=function(a){this.controls.push(a)};window.selectFilter=function(a){n.style.display="none";for(var b=0;b<n.options.length;b++)if(n.options[b].text===a){n.selectedIndex=b;break}};window.addFilter=function(a){var b=document.createElement("option");b.text=a.name;b.filter=a;n.add(b)};window.Filter=q;window.loadImage=b;window.createSlider=function(a,b,d,e,f,g,h,k){var c=document.createElement("div");c.innerHTML=
'<div class="input-group" style="max-width:420px; margin:auto;"><span class="input-group-addon title">'+d+'</span><input type="range" class="form-control" id="'+b+'" ><span class="input-group-addon value">'+e+"</span></div>";a.appendChild(c);var m=document.getElementById(b);m.min=f;m.max=g;m.step=h;m.value=e;m.oninput=m.onchange=function(a){m.nextSibling.innerText=this.value};m.onmouseup=m.ontouchend=k;return m};window.createButton=function(a,b,d,e){var c=document.createElement("button");c.addClass=
"btn btn-primary";c.innerText=d;c.name=b;c.onclick=e;a.appendChild(c);return c};window.createSelector=function(a,b){var c={x:0,y:0,w:0,h:0},d={canvas:a,value:null};a.onmousedown=function(a){c.x=a.offsetX;c.y=a.offsetY};a.onmousemove=function(b){b.buttons&&(c.w=b.offsetX-c.x,c.h=b.offsetY-c.y,b=a.getContext("2d"),redraw(),b.beginPath(),b.rect(c.x,c.y,c.w,c.h),b.stroke())};a.onmouseup=function(a){b(c)};return d};onLoadedGFX()}},!0);
function onLoadedGFX(){var a=document.querySelector("div[data-role=preview]");if(a){var h=a.getAttribute("data-source"),d=a.getAttribute("data-callback"),b=a.querySelector("canvas");window.loadImage(h,function(){window[d](b,b);cmbFilters.onchange();1===cmbFilters.options.length&&(cmbFilters.style.display="none")})}};
